### [참고 : 길벗 : 만화로 배우는 리눅스 시스템 관리 2](https://www.yes24.com/Product/Goods/33569480)
---
# linuxsystem_management
## 정기적인 작업을 자동으로 처리하고 싶어
* crond : 리눅스 내부에서 지정한 시각에 명령어를 실행하는 서비스
* ```crontab```을 이용
  - crond 로 실행하고 싶은 명령어와 실행 시각을 관리
* 등록된 ```crontab``` 리스트 확인하기
> sudo crontab -l
```
0   3   *   *   *   /scripts/do_backup.sh
30  2,14    *   *   *   /scripts/do_update.sh
# 매주 월요일 오전 11시 45분에 실행
45  11  *   *   1   [실행할 파일의 절대 경로]
# 실행 결과 메일로 받기
MAILTO=byonghwan@trial-net.co.kr
45  11  *   *   1   [실행할 파일의 절대 경로]
# 주의 사항 : 아래와 같이 하면 21시 매분마다 실행됨. 
# 21시 정각의 경우 0    21 로 해야 함.
*   21  *   *   *   [실행할 파일의 절대 경로]
```
* 첫번째 : 분
* 두번째 : 시각
* 세번째 : 일
* 네번째 : 월
* 다섯번째 : 요일 (0:일, 1:월, 2:화, ~, 6:토, 7:일)
* 첫번째 설명
  * 매일 새벽 3시에 실행
  * 매일 새벽 2시 30분과 오후 2시 30분에 실행

## 키 인증으로 안전하게 로그인하고 싶어
> ssh-keygen
* 전용키 쌍을 만드는 명령어
* 패스프레이즈 키를 입력한다. 확인을 위해 총 2회 입력을 한다.
* 입력 완료 후 사용자 폴더의 하위에 ```.ssh``` 폴더가 만들어 진다.
* 이 폴더에는 2개의 파일이 존재한다.
```
# 비밀키
id_rsa
# 공개키용 파일
id_rsa.pub
```
* 이 둘 중 id_rsa.pub 파일을 접속하려는 서버에 복사하고 관련 환경 설정을 한다.
> \$ scp id_rsa.pub ubuntu@192.168.56.101:~  # 원격 서버에 파일 복사 \
> \$ ssh ubuntu@192.168.56.101  # 원격 서버에 패스워드 입력 방식으로 접속 \
> \$ sudo mkdir -p .ssh  # 폴더 만들기 \
> \$ sudo mv ~/id_rsa.pub ~/.ssh/autorized_keys  # 공개키 파일을 .ssh에 복사 \
> \$ sudo chown -R ubuntu:ubuntu .ssh/  # 사용자 및 그룹 설정 \
> \$ sudo chmod 700 .ssh  # 폴더 접속 권한 변경 \
> \$ sudo chmod 600 .ssh/authorized_keys  # 파일 접속 권한 변경
* 서버에 직접 접속하면 passphrase키를 이력한 후에 접속이 가능해 진다.
> \$ ssh ubuntu@192.168.56.101 \
> Enter passphrae for key '/home/ubuntu/.ssh/id_rsa': _

※ ssh-copy-ld 명령어로 한 꺼번에 작업이 가능하다. (단, 서버에 접속이 가능해야 한다.)

## 정시에 자동으로 scp 하고 싶어
* 패스프레이즈 없는 비밀키를 사용하면 자동으로 키 인증 가능함(자동 인증)
* 안전하도록 자동인증용 키 쌍은 인증 후 할 수 있는 일을 가능한 제한하기(일반 작업에만 쓰고 로그인용으로 사용하지 않기)
* cronjob으로 scp한다면 자동 인증용 비밀키를 -i 옵션으로 지정해서 키 인증하거나 공개키라면 실행할 scp 명령어 내용에 대응하는 서버 쪽 명령어열을 command='명령어열' 형식으로 설정하기



